<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø®Ø±ÙˆØ¬ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ú©Ø§Ø±ØªÚ©Ø³</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        @font-face { font-family: 'Doran'; src: url('fonts/DoranFaNum-Bold.ttf'); font-weight: bold; }
        @font-face { font-family: 'Doran'; src: url('fonts/DoranFaNum-Light.ttf'); font-weight: normal; }
        body { font-family: 'Doran', sans-serif; background: #f0f2f5; }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ Ú©Ø§Ø±ØªÚ©Ø³ */
        .page-pdf { 
            width: 210mm; min-height: 297mm; background: white; padding: 40px; 
            position: relative; overflow: hidden;
        }
        /* ÙˆØ§ØªØ±Ù…Ø§Ø±Ú© Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ */
        .page-pdf::before {
            content: ""; position: absolute; top: 50%; left: 50%; 
            width: 80%; height: 80%; transform: translate(-50%, -50%);
            background-image: url('https://www.transparenttextures.com/patterns/notebook.png');
            opacity: 0.05; pointer-events: none;
        }
        
        .header-box { border-bottom: 3px solid #1e3c72; padding-bottom: 15px; margin-bottom: 25px; }
        table { width: 100%; border: 2px solid #333; }
        th, td { border: 1.5px solid #333; padding: 12px; text-align: center; }
        th { background: #f8f9fa; font-weight: bold; }
        .footer-sec { margin-top: auto; display: flex; justify-content: space-between; border-top: 2px solid #333; padding-top: 20px; }
    </style>
</head>
<body>
    <div class="container py-4 no-print text-center">
        <input type="text" id="weekInput" class="form-control w-25 d-inline-block text-center" placeholder="Ú©Ø¯ Ø¨Ø±Ù†Ø§Ù…Ù‡">
        <button class="btn btn-primary" onclick="generatePDF()">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø³ØªÙ‚ÛŒÙ… PDF Ú©Ù„ Ù‡ÙØªÙ‡</button>
    </div>

    <div id="pdf-content"></div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyimURf79KriPsge81PcJhcd7L-C897A7xdvF9O05EsYt5s_3FUmhaIlR_lcL2vJMab/exec";
        const LOGO = "https://raw.githubusercontent.com/ehsanafsharmanesh/ehsanafsharmanesh.github.io/main/newlogo.jpg";
        
        async function generatePDF() {
            const week = document.getElementById('weekInput').value;
            const profile = JSON.parse(localStorage.getItem("profile"));
            
            const res = await fetch(SCRIPT_URL, {method:'POST', body:JSON.stringify({action:"getWeekPlan", studentCode: profile.username, weekNum: week})});
            const result = await res.json();
            
            let html = "";
            result.data.forEach(day => {
                html += `
                <div class="page-pdf">
                    <div class="header-box d-flex justify-content-between">
                        <div><h3>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ² ${day.dayName}</h3><p>ØªØ§Ø±ÛŒØ®: ${day.date.split('T')[0]}</p></div>
                        <div class="text-end"><strong>Ø¯Ø§ÙˆØ·Ù„Ø¨: ${profile.firstName} ${profile.lastName}</strong><br>Ù‡ÙØªÙ‡: ${week}</div>
                    </div>
                    <table>
                        <thead><tr><th>Ø²Ù…Ø§Ù†</th><th>ÙØ¹Ø§Ù„ÛŒØª Ø¢Ù…ÙˆØ²Ø´ÛŒ</th><th>ØªØ§ÛŒÛŒØ¯</th></tr></thead>
                        <tbody>
                            ${day.tasks.map(t => `<tr><td>${t.time}</td><td>${t.lesson}</td><td>âœ”ï¸</td></tr>`).join('')}
                        </tbody>
                    </table>
                    <div class="footer-sec">
                        <div style="width: 70%"><strong>Ø­Ø±Ù Ø±ÙˆØ²:</strong><br>Ù…Ø³ÛŒØ± Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø² ØªØ¯Ø§ÙˆÙ… Ù…ÛŒâ€ŒÚ¯Ø°Ø±Ø¯.</div>
                        <div class="text-center"><img src="${LOGO}" width="120"><br><small>Ø¢Ú©Ø§Ø¯Ù…ÛŒ Ø¯Ú©ØªØ± Ø§ÙØ´Ø§Ø±Ù…Ù†Ø´</small></div>
                    </div>
                </div>`;
            });
            
            document.getElementById('pdf-content').innerHTML = html;
            
            const opt = { margin: 0, filename: `Plan-Week-${week}.pdf`, image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } };
            html2pdf().set(opt).from(document.getElementById('pdf-content')).save();
        }
    </script>
</body>
</html>
