<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯ÙØªØ±Ú†Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ù‡ÙØªÚ¯ÛŒ - Ø¢Ú©Ø§Ø¯Ù…ÛŒ Ø¯Ú©ØªØ± Ø§ÙØ´Ø§Ø±Ù…Ù†Ø´</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        
        body { background-color: #f4f7f6; font-family: 'Vazirmatn', Tahoma, sans-serif; }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø³Ø§ÛŒØª */
        .no-print { background: white; padding: 20px; border-bottom: 2px solid #007bff; position: sticky; top: 0; z-index: 1000; }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ù‡Ø± ØµÙØ­Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ */
        .page-container { 
            background: white; 
            width: 277mm; /* Ø¹Ø±Ø¶ A4 Ø§ÙÙ‚ÛŒ */
            height: 190mm; /* Ø§Ø±ØªÙØ§Ø¹ ØªÙ‚Ø±ÛŒØ¨ÛŒ Ø¨Ø±Ø§ÛŒ Ø¬Ø§ Ø´Ø¯Ù† Ø¯Ø± ÛŒÚ© ØµÙØ­Ù‡ */
            margin: 20px auto; 
            padding: 15px 30px; 
            border: 2px solid #333; 
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .start-badge { 
            position: absolute; top: -10px; right: 50px; 
            background: #d32f2f; color: white; padding: 5px 20px; 
            font-weight: bold; border-radius: 5px; font-size: 14px;
        }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 2px solid #000; padding: 8px; text-align: center; font-size: 16px; }
        th { background-color: #f2f2f2; font-weight: bold; }
        
        .footer-info { display: flex; justify-content: space-between; align-items: center; border-top: 2px solid #000; padding-top: 10px; }
        .stamp-img { width: 130px; }

        /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú†Ø§Ù¾ */
        @media print {
            @page { size: A4 landscape; margin: 0; }
            body { background: white; padding: 0; }
            .no-print { display: none !important; }
            .page-container { margin: 0; border: none; width: 100%; height: 100vh; page-break-after: always; padding: 40px; }
            .page-container { border-bottom: 1px solid #eee; }
        }
    </style>
</head>
<body>

<div class="no-print">
    <div class="container text-center">
        <h4 class="mb-3">ØµØ¯ÙˆØ± Ø¯ÙØªØ±Ú†Ù‡ Ù‡ÙØªÚ¯ÛŒ Ø¢Ú©Ø§Ø¯Ù…ÛŒ</h4>
        <div class="d-flex justify-content-center gap-2">
            <input type="text" id="weekInput" class="form-control w-25 text-center fs-5" placeholder="Ú©Ø¯ Ù‡ÙØªÙ‡ (Ù…Ø«Ù„Ø§Ù‹ 05)">
            <button class="btn btn-primary px-4" onclick="loadWeeklyData()">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ùˆ Ú†ÛŒØ¯Ù…Ø§Ù† Ø§ÙÙ‚ÛŒ</button>
            <button class="btn btn-success px-4" onclick="window.print()">ğŸ–¨ï¸ Ú†Ø§Ù¾ Ù…Ø³ØªÙ‚ÛŒÙ… A4</button>
        </div>
    </div>
</div>

<div id="print-content">
    </div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby8NJAfUez3wCUiRXthdSuRT0thlXL_bPS2rDXGpcJhb25wdejrhKvMZ5DjxlZLv6Nh/exec";
    const studentCode = localStorage.getItem("planner_code") || "tahsili38";

    async function loadWeeklyData() {
        const weekNum = document.getElementById('weekInput').value;
        if(!weekNum) return;
        
        document.getElementById('print-content').innerHTML = "<p class='text-center mt-5'>Ø¯Ø± Ø­Ø§Ù„ ØªÙ†Ø¸ÛŒÙ… Ú†ÛŒØ¯Ù…Ø§Ù† ØµÙØ­Ø§Øª...</p>";
        
        try {
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ action: "getWeekPlan", studentCode: studentCode, weekNum: weekNum })
            });
            const result = await response.json();
            
            if(result.status === "success" && result.data.length > 0) {
                renderLandscapePages(result.data, weekNum);
            } else {
                alert("Ø¯ÛŒØªØ§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ø¯ Ù‡ÙØªÙ‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
            }
        } catch (e) {
            alert("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±");
        }
    }

    function renderLandscapePages(data, weekNum) {
        const container = document.getElementById('print-content');
        container.innerHTML = "";

        data.forEach((dayData, index) => {
            let html = `
                <div class="page-container">
                    ${index === 0 ? '<div class="start-badge">Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡</div>' : ''}
                    
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 style="color: #1a237e;">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ² ${dayData.dayName}</h2>
                        <div class="text-end">
                            <div class="fw-bold">Ú©Ø¯ Ù…Ø±Ø§Ø¬Ø¹: ${studentCode}</div>
                            <div>ØªØ§Ø±ÛŒØ®: ${dayData.date} | Ú©Ø¯ Ù‡ÙØªÙ‡: ${weekNum}</div>
                        </div>
                    </div>`;

            if(dayData.exam) {
                html += `<div style="background:#fff3e0; border:2px solid #ff9800; padding:10px; text-align:center; margin-bottom:10px; font-weight:bold; font-size:18px;">ğŸ“¢ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø®Ø§Øµ: ${dayData.exam}</div>`;
            }

            html += `<table>
                <thead>
                    <tr><th style="width:20%">Ø²Ù…Ø§Ù†</th><th>Ù…Ø­ØªÙˆØ§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø·Ø§Ù„Ø¹Ø§ØªÛŒ Ùˆ ÙØ¹Ø§Ù„ÛŒØª Ø¢Ù…ÙˆØ²Ø´ÛŒ</th><th style="width:12%">ØªØ§ÛŒÛŒØ¯</th></tr>
                </thead>
                <tbody>`;

            // Ù†Ù…Ø§ÛŒØ´ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø´ÛŒØª
            dayData.tasks.forEach(task => {
                html += `<tr><td>${task.time}</td><td>${task.lesson}</td><td></td></tr>`;
            });

            // Ø§ÙØ²ÙˆØ¯Ù† Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø± Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡
            const emptyRowsNeeded = 10 - dayData.tasks.length;
            for(let i=0; i < (emptyRowsNeeded > 0 ? emptyRowsNeeded : 2); i++) {
                html += `<tr style="height:40px"><td></td><td></td><td></td></tr>`;
            }

            html += `</tbody></table>
                    
                    <div class="footer-info">
                        <div style="max-width:75%">
                            <strong style="font-size:18px;">ğŸ’¡ Ø¬Ù…Ù„Ù‡ Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ Ù‡ÙØªÙ‡:</strong>
                            <p style="font-size:16px; margin-top:5px; color:#444;">${dayData.quote || 'Ù¾ÛŒØ±ÙˆØ²ÛŒ Ø§Ø² Ø¢Ù† Ú©Ø³Ø§Ù†ÛŒ Ø§Ø³Øª Ú©Ù‡ ØªØ§ Ø¢Ø®Ø±ÛŒÙ† Ù„Ø­Ø¸Ù‡ ØªÙ„Ø§Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.'}</p>
                        </div>
                        <div class="text-center">
                            <img src="https://raw.githubusercontent.com/ehsanafsharmanesh/ehsanafsharmanesh.github.io/main/newlogo.jpg" class="stamp-img">
                            <div style="font-size:12px; font-weight:bold;">Ø¢Ú©Ø§Ø¯Ù…ÛŒ Ø¯Ú©ØªØ± Ø§ÙØ´Ø§Ø±Ù…Ù†Ø´</div>
                        </div>
                    </div>
                </div>`;
            
            container.innerHTML += html;
        });
    }
</script>
</body>
</html>
