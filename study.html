<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯ÙØªØ±Ú†Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ù‡ÙØªÚ¯ÛŒ Ø¢Ú©Ø§Ø¯Ù…ÛŒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; font-family: 'Tahoma', sans-serif; }
        .no-print { background: white; padding: 20px; border-bottom: 2px solid #ddd; }
        .day-container { 
            background: white; 
            margin: 20px auto; 
            padding: 25px; 
            border: 1px solid #000; 
            max-width: 900px;
            page-break-after: always; /* Ù‡Ø± Ø±ÙˆØ² Ø¯Ø± ÛŒÚ© ØµÙØ­Ù‡ Ø¬Ø¯Ø§ Ú†Ø§Ù¾ Ø´ÙˆØ¯ */
        }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #000; padding: 10px; text-align: center; font-size: 14px; }
        th { background-color: #f2f2f2; }
        .stamp-section { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; border-top: 1px solid #000; padding-top: 10px; }
        .logo-img { width: 120px; }
        .empty-row { height: 35px; }
        
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .day-container { margin: 0; border: none; }
        }
    </style>
</head>
<body>

<div class="no-print">
    <div class="container text-center">
        <h4 class="mb-3 text-primary">Ù¾Ù†Ù„ Ú†Ø§Ù¾ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ</h4>
        <div class="d-flex justify-content-center gap-2">
            <input type="text" id="weekInput" class="form-control w-25 text-center" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ (Ù…Ø«Ù„Ø§Ù‹ 05)">
            <button class="btn btn-primary" onclick="loadWeeklyData()">Ø¯Ø±ÛŒØ§ÙØª Ú©Ù„ Ù‡ÙØªÙ‡</button>
            <button class="btn btn-success" onclick="window.print()">ğŸ–¨ï¸ Ú†Ø§Ù¾ Ø¯ÙØªØ±Ú†Ù‡</button>
        </div>
        <div id="loader" class="mt-3" style="display:none;">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª...</div>
    </div>
</div>

<div id="print-content">
    </div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyyJaeaBi301y227SSIEzoWO9G9MqJXSKfesvVca2vh7vsf207NRmLxxXCOkn-PaACf/exec";
    const studentCode = localStorage.getItem("planner_code") || "tahsili38";

    async function loadWeeklyData() {
        const weekNum = document.getElementById('weekInput').value;
        if(!weekNum) { alert("Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"); return; }
        
        document.getElementById('loader').style.display = "block";
        
        try {
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ action: "getWeekPlan", studentCode: studentCode, weekNum: weekNum })
            });
            const result = await response.json();
            
            if(result.status === "success") {
                renderPages(result.data, weekNum);
            } else {
                alert("Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
            }
        } catch (e) {
            alert("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ú¯ÙˆÚ¯Ù„");
        } finally {
            document.getElementById('loader').style.display = "none";
        }
    }

    function renderPages(data, weekNum) {
        const container = document.getElementById('print-content');
        container.innerHTML = "";
        const daysOfWeek = ["Ø´Ù†Ø¨Ù‡", "ÛŒÚ©Ø´Ù†Ø¨Ù‡", "Ø¯ÙˆØ´Ù†Ø¨Ù‡", "Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡", "Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡", "Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡", "Ø¬Ù…Ø¹Ù‡"];

        daysOfWeek.forEach(dayName => {
            const dayData = data.find(d => d.dayName === dayName);
            
            let html = `
                <div class="day-container">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ² ${dayName}</h5>
                        <span>Ú©Ø¯ Ù…Ø±Ø§Ø¬Ø¹: ${studentCode} | Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø´Ù…Ø§Ø±Ù‡: ${weekNum}</span>
                        <span>ØªØ§Ø±ÛŒØ®: ${dayData ? dayData.date : '---'}</span>
                    </div>`;

            if(dayData && dayData.exam) {
                html += `<div style="background:#ffebee; border:1px solid #c62828; padding:5px; text-align:center; margin-bottom:10px;"><strong>Ø¢Ø²Ù…ÙˆÙ†:</strong> ${dayData.exam}</div>`;
            }

            html += `<table>
                <thead>
                    <tr><th style="width:25%">Ø²Ù…Ø§Ù†</th><th>Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ùˆ ÙØ¹Ø§Ù„ÛŒØª</th><th style="width:15%">ØªØ§ÛŒÛŒØ¯</th></tr>
                </thead>
                <tbody>`;

            if(dayData && dayData.tasks.length > 0) {
                // Ù†Ù…Ø§ÛŒØ´ Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø± Ø´Ø¯Ù‡ Ø¯Ø± Ø´ÛŒØª
                dayData.tasks.forEach(task => {
                    html += `<tr><td>${task.time}</td><td>${task.lesson}</td><td></td></tr>`;
                });
            } else {
                // Ø³Ø§Ø®Øª Û±Û° Ø±Ø¯ÛŒÙ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø±ÙˆØ²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø± Ø´ÛŒØª Ù†ÛŒØ³ØªÙ†Ø¯
                for(let i=0; i<12; i++) {
                    html += `<tr class="empty-row"><td></td><td></td><td></td></tr>`;
                }
            }

            html += `</tbody></table>
                    <div class="stamp-section">
                        <div style="max-width:70%">
                            <strong>Ø¬Ù…Ù„Ù‡ Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ Ù‡ÙØªÙ‡:</strong>
                            <p style="font-size:13px; margin-top:5px;">${dayData ? dayData.quote : 'Ù…ÙˆÙÙ‚ÛŒØª ÛŒØ¹Ù†ÛŒ ØªÚ©Ø±Ø§Ø± Ø±ÙˆØ²Ø§Ù†Ù‡ ØªÙ„Ø§Ø´â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú©.'}</p>
                        </div>
                        <div class="text-center">
                            <img src="https://raw.githubusercontent.com/ehsanafsharmanesh/ehsanafsharmanesh.github.io/main/newlogo.jpg" class="logo-img">
                            <p style="font-size:10px; margin:0;">Ø¢Ú©Ø§Ø¯Ù…ÛŒ Ø¯Ú©ØªØ± Ø§ÙØ´Ø§Ø±Ù…Ù†Ø´</p>
                        </div>
                    </div>
                </div>`;
            
            container.innerHTML += html;
        });
    }
</script>
</body>
</html>
