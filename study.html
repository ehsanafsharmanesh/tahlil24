<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù¾Ù†Ù„ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø¢Ú©Ø§Ø¯Ù…ÛŒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: Tahoma; }
        .day-section { background: white; border-radius: 15px; padding: 20px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .empty-day { border: 2px dashed #ccc; color: #999; }
        @media print {
            .no-print { display: none !important; }
            .day-section { page-break-inside: avoid; border: 1px solid #000; box-shadow: none; margin-bottom: 50px; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid #000; padding: 8px; text-align: center; }
            .stamp-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        }
    </style>
</head>
<body>

<div class="container py-4 no-print">
    <h3 class="text-center text-primary mb-4">Ø¯Ø±ÛŒØ§ÙØª Ø¯ÙØªØ±Ú†Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ</h3>
    <div class="card p-4 shadow-sm mb-4">
        <label class="form-label">Ø´Ù…Ø§Ø±Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹: 05):</label>
        <div class="input-group">
            <input type="text" id="weekInput" class="form-control text-center fs-4" placeholder="00">
            <button class="btn btn-primary" onclick="loadWeek()">Ø¯Ø±ÛŒØ§ÙØª Ø¨Ø±Ù†Ø§Ù…Ù‡</button>
        </div>
    </div>
    <div id="status-msg"></div>
</div>

<div id="main-content" class="container"></div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwV4xtFwbAdBGrMguFyTwzijCkK8XbYY230Sdsgp8MKVX8Qxz7-4MEFmdUlPDmZy5Iz/exec";
    const studentCode = localStorage.getItem("planner_code") || "tahsili38";

    async function loadWeek() {
        const weekNum = document.getElementById('weekInput').value;
        const contentDiv = document.getElementById('main-content');
        if(!weekNum) return;

        contentDiv.innerHTML = "<p class='text-center'>Ø¯Ø± Ø­Ø§Ù„ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‡ÙØªÙ‡...</p>";

        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: "getWeekPlan", studentCode: studentCode, weekNum: weekNum })
            });
            const result = await res.json();

            if(result.status === "success") {
                renderWeeklyPlan(result.data);
            }
        } catch (e) {
            alert("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø´ÛŒØª");
        }
    }

    function renderWeeklyPlan(daysFromSheet) {
        const contentDiv = document.getElementById('main-content');
        contentDiv.innerHTML = "";
        
        // Ù„ÛŒØ³Øª Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù‡ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ø¬Ø¯Ø§ÙˆÙ„ Ø®Ø§Ù„ÛŒ
        const weekDays = ["Ø´Ù†Ø¨Ù‡", "ÛŒÚ©Ø´Ù†Ø¨Ù‡", "Ø¯ÙˆØ´Ù†Ø¨Ù‡", "Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡", "Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡", "Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡", "Ø¬Ù…Ø¹Ù‡"];
        
        weekDays.forEach((dayName) => {
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¯ÛŒØªØ§ÛŒ Ø§ÛŒÙ† Ø±ÙˆØ² Ø¯Ø± Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´ÛŒØª
            const dayData = daysFromSheet.find(d => d.dayName === dayName);
            
            let html = `<div class="day-section ${!dayData ? 'empty-day' : ''}">
                <div class="d-flex justify-content-between align-items: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 15px;">
                    <h4>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ² ${dayName}</h4>
                    <span>ØªØ§Ø±ÛŒØ®: ${dayData ? dayData.date : '........'}</span>
                </div>`;

            if(dayData && dayData.exam) {
                html += `<div class="alert alert-danger text-center"><strong>Ø¢Ø²Ù…ÙˆÙ†:</strong> ${dayData.exam}</div>`;
            }

            html += `<table>
                <thead><tr><th style="width:30%">Ø²Ù…Ø§Ù†</th><th>Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø·Ø§Ù„Ø¹Ù‡</th><th style="width:15%">ØªØ§ÛŒÛŒØ¯</th></tr></thead>
                <tbody>`;

            if(dayData) {
                dayData.tasks.forEach(t => {
                    html += `<tr><td>${t.time}</td><td>${t.lesson}</td><td></td></tr>`;
                });
            } else {
                // Ø§Ú¯Ø± Ø±ÙˆØ² Ø¯Ø± Ø´ÛŒØª Ù†Ø¨ÙˆØ¯ØŒ Û±Û° Ø±Ø¯ÛŒÙ Ø®Ø§Ù„ÛŒ Ø¨Ø³Ø§Ø²
                for(let i=0; i<10; i++) html += `<tr style="height:40px"><td></td><td></td><td></td></tr>`;
            }

            html += `</tbody></table>
                <div class="stamp-footer">
                    <p style="font-style: italic; font-size: 12px; max-width: 70%;">Ø¬Ù…Ù„Ù‡ Ù‡ÙØªÙ‡: ${dayData ? dayData.quote : 'Ù…ÙˆÙÙ‚ÛŒØª ØªØ¯Ø§ÙˆÙ… Ú©ÙˆÚ†Ú©ØªØ±ÛŒÙ† ØªÙ„Ø§Ø´â€ŒÙ‡Ø§Ø³Øª.'}</p>
                    <div class="text-center">
                        <img src="https://raw.githubusercontent.com/ehsanafsharmanesh/ehsanafsharmanesh.github.io/main/newlogo.jpg" style="width:100px;">
                        <p style="font-size: 10px; margin:0;">Ø¢Ú©Ø§Ø¯Ù…ÛŒ Ø¯Ú©ØªØ± Ø§ÙØ´Ø§Ø±Ù…Ù†Ø´</p>
                    </div>
                </div>
            </div>`;
            
            contentDiv.innerHTML += html;
        });

        contentDiv.innerHTML += `<button class="btn btn-success w-100 no-print py-3 mb-5" onclick="window.print()">ğŸ–¨ï¸ Ú†Ø§Ù¾ Ú©Ù„ Ø¯ÙØªØ±Ú†Ù‡ Ù‡ÙØªÙ‡</button>`;
    }
</script>
</body>
</html>
