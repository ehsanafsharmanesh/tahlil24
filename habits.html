<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø¯ÛŒØ§Ø¨ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ | Ø¢Ú©Ø§Ø¯Ù…ÛŒ Ø¯Ú©ØªØ± Ø§ÙØ´Ø§Ø±Ù…Ù†Ø´</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        @font-face { font-family: 'Doran'; src: url('fonts/DoranFaNum-Medium.ttf'); }
        body { background-color: #f8f9fa; font-family: 'Doran', sans-serif; padding: 20px; }
        .card { border-radius: 20px; border: none; box-shadow: 0 10px 25px rgba(0,0,0,0.05); padding: 25px; }
        .habit-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 15px; border: 2px solid #f1f3f5; border-radius: 15px; margin-bottom: 10px; 
            cursor: pointer; transition: 0.3s;
        }
        .habit-item.active { border-color: #007bff; background-color: #f8fbff; }
        .btn-add { background: #6c757d; color: white; border-radius: 12px; width: 100%; padding: 12px; border: none; margin-top: 10px; }
        .btn-save { background: #28a745; color: white; border-radius: 12px; width: 100%; padding: 15px; border: none; margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container" style="max-width: 500px;">
    <div class="card">
        <h4 class="text-center mb-4">Ø±Ø¯ÛŒØ§Ø¨ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡</h4>
        
        <div id="habit-list">
            <div class="habit-item" onclick="toggleHabit(this, 'Ø®ÙˆØ§Ø¨ Ø¨Ù‡â€ŒÙ…ÙˆÙ‚Ø¹')"><span>ğŸŒ™ Ø®ÙˆØ§Ø¨ Ø¨Ù‡â€ŒÙ…ÙˆÙ‚Ø¹</span></div>
            <div class="habit-item" onclick="toggleHabit(this, 'Ø¨ÛŒØ¯Ø§Ø±ÛŒ Ø¨Ù‡â€ŒÙ…ÙˆÙ‚Ø¹')"><span>â° Ø¨ÛŒØ¯Ø§Ø±ÛŒ Ø¨Ù‡â€ŒÙ…ÙˆÙ‚Ø¹</span></div>
            <div class="habit-item" onclick="toggleHabit(this, 'ÙˆØ±Ø²Ø´')"><span>ğŸ’ª ÙˆØ±Ø²Ø´</span></div>
            <div class="habit-item" onclick="toggleHabit(this, 'ØµØ¨Ø­Ø§Ù†Ù‡')"><span>ğŸ³ ØµØ¨Ø­Ø§Ù†Ù‡</span></div>
            <div class="habit-item" id="mobile-trigger" onclick="toggleMobile(this)"><span>ğŸ“± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…ÙˆØ¨Ø§ÛŒÙ„</span></div>
            <div id="mobile-input-box" class="d-none mb-3">
                <input type="number" id="mobileTime" class="form-control" placeholder="Ú†Ù†Ø¯ Ø¯Ù‚ÛŒÙ‚Ù‡ØŸ">
            </div>
        </div>

        <div class="mt-4">
            <input type="text" id="newHabitName" class="form-control mb-2" placeholder="Ù†Ø§Ù… Ø¹Ø§Ø¯Øª Ø¬Ø¯ÛŒØ¯...">
            <button class="btn-add" onclick="addNewHabit()">â• Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª</button>
        </div>

        <button class="btn-save" onclick="saveHabits()">ğŸš€ Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²</button>
        <button class="btn btn-link w-100 mt-2 text-decoration-none text-muted" onclick="location.href='index.html'">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxMgZw_YbVgPf6kvK1gOdgtaQw2e7NhNQKOXbJBPFx1nYhzS2ZyP112FdNVZomSqkx0/exec";
    const profile = JSON.parse(localStorage.getItem("profile") || "{}");
    let activeHabits = new Set();

    function toggleHabit(el, name) {
        el.classList.toggle('active');
        if (activeHabits.has(name)) activeHabits.delete(name);
        else activeHabits.add(name);
    }

    function toggleMobile(el) {
        el.classList.toggle('active');
        document.getElementById('mobile-input-box').classList.toggle('d-none');
    }

    function addNewHabit() {
        const name = document.getElementById('newHabitName').value;
        if (!name) return;
        const div = document.createElement('div');
        div.className = 'habit-item';
        div.innerHTML = `<span>âœ¨ ${name}</span>`;
        div.onclick = function() { toggleHabit(this, name); };
        document.getElementById('habit-list').appendChild(div);
        document.getElementById('newHabitName').value = "";
    }

    async function saveHabits() {
        const data = {
            action: "saveReport", // Ø§Ø² Ù‡Ù…Ø§Ù† ØªØ§Ø¨Ø¹ Ø°Ø®ÛŒØ±Ù‡ Ú¯Ø²Ø§Ø±Ø´ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            username: profile.username,
            habits: Array.from(activeHabits).join('ØŒ '),
            mobileTime: document.getElementById('mobileTime').value || 0,
            type: "habit_only"
        };

        try {
            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(data) });
            alert("Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.");
            location.href = "index.html";
        } catch(e) { alert("Ø«Ø¨Øª Ø´Ø¯."); location.href = "index.html"; }
    }
</script>
</body>
</html>
