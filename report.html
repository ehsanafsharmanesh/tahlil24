<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ | Ø¢Ú©Ø§Ø¯Ù…ÛŒ Ø¯Ú©ØªØ± Ø§ÙØ´Ø§Ø±Ù…Ù†Ø´</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider/distribute/nouislider.min.css">
    <style>
        /* Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªÙ…Ø§Ù… ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ±Ø§Ù† Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ù¾ÙˆØ´Ù‡ fonts */
        @font-face { font-family: 'Doran'; src: url('fonts/DoranFaNum-Light.ttf'); font-weight: 300; }
        @font-face { font-family: 'Doran'; src: url('fonts/DoranFaNum-Regular.ttf'); font-weight: 400; }
        @font-face { font-family: 'Doran'; src: url('fonts/DoranFaNum-Medium.ttf'); font-weight: 500; }
        @font-face { font-family: 'Doran'; src: url('fonts/DoranFaNum-Bold.ttf'); font-weight: 700; }

        body { background-color: #f4f7f6; font-family: 'Doran', Tahoma, sans-serif; overflow-x: hidden; }
        
        /* Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ú¯Ø±Ø§Ø¯ÛŒØ§Ù†ØªÛŒ Ù…ØªØ­Ø±Ú© Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ */
        .progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 7px; background: #e0e0e0; z-index: 2000; }
        .progress-bar-fill { 
            height: 100%; width: 0%; 
            background: linear-gradient(90deg, #007bff, #00ffcc, #007bff); 
            background-size: 200% 100%; 
            animation: gradientMove 2s linear infinite;
            transition: width 0.5s ease;
        }
        @keyframes gradientMove { 0% {background-position: 100% 0%;} 100% {background-position: -100% 0%;} }

        .step-card { display: none; background: white; border-radius: 25px; padding: 35px; box-shadow: 0 15px 35px rgba(0,0,0,0.05); margin-top: 60px; border: 1px solid #eee; }
        .step-card.active { display: block; animation: fadeInUp 0.4s ease; }
        @keyframes fadeInUp { from {opacity: 0; transform: translateY(30px);} to {opacity: 1; transform: translateY(0);} }

        .btn-nav { border-radius: 15px; padding: 15px; font-weight: 700; transition: 0.3s; width: 100%; border: none; }
        .btn-next { background: #007bff; color: white; }
        .btn-back { background: #f8f9fa; color: #666; margin-top: 10px; }
        
        .habit-option { 
            border: 2px solid #f0f0f0; padding: 15px; border-radius: 15px; margin-bottom: 10px; 
            cursor: pointer; transition: 0.3s; display: flex; justify-content: space-between; align-items: center;
        }
        .habit-option.selected { border-color: #007bff; background: #f0f7ff; }
        
        .lesson-chip { background: #f8f9fa; border: 1px solid #ddd; padding: 8px 15px; border-radius: 10px; margin: 5px; display: inline-block; cursor: pointer; }
        .lesson-chip.active { background: #28a745; color: white; border-color: #28a745; }

        label { font-weight: 700; margin-bottom: 10px; display: block; color: #444; }
        .form-control-lg { border-radius: 15px; border: 2px solid #eee; text-align: center; font-weight: 700; }
    </style>
</head>
<body>

<div class="progress-container"><div id="main-progress" class="progress-bar-fill"></div></div>

<div class="container" style="max-width: 550px; padding-bottom: 50px;">
    
    <div id="step-1" class="step-card active">
        <h4 class="text-center mb-4">Ø´Ù…Ø§Ø±Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ (Ù‡ÙØªÙ‡)</h4>
        <p class="text-center text-muted mb-4">Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ Ù‡ÙØªÙ‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¯Ø± Ø¢Ù† Ù‡Ø³ØªÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
        <input type="number" id="weekNum" class="form-control form-control-lg mb-4" placeholder="Ù…Ø«Ù„Ø§Ù‹ 5">
        <button class="btn-nav btn-next" onclick="nextStep(2)">ØªØ§ÛŒÛŒØ¯ Ùˆ Ø´Ø±ÙˆØ¹</button>
    </div>

    <div id="step-2" class="step-card">
        <h4 class="mb-4">Ø±Ø¯ÛŒØ§Ø¨ Ø¹Ø§Ø¯Ø§Øª Ø±ÙˆØ²Ø§Ù†Ù‡</h4>
        <div class="habit-option" onclick="toggleHabit(this, 'wakeUp')"><span>â° Ø¨ÛŒØ¯Ø§Ø±ÛŒ Ø¨Ù‡â€ŒÙ…ÙˆÙ‚Ø¹</span><input type="checkbox"></div>
        <div class="habit-option" onclick="toggleHabit(this, 'exercise')"><span>ğŸ’ª ÙˆØ±Ø²Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡</span><input type="checkbox"></div>
        <div class="habit-option" onclick="toggleHabit(this, 'mobile')"><span>ğŸ“± Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù…ÙˆØ¨Ø§ÛŒÙ„</span><input type="checkbox"></div>
        <div id="mobile-box" class="d-none mt-2 mb-3">
            <label>Ù…ÛŒØ²Ø§Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ (Ø¯Ù‚ÛŒÙ‚Ù‡):</label>
            <input type="number" id="mobileTime" class="form-control" placeholder="Ù…Ø«Ù„Ø§Ù‹ 45">
        </div>
        <button class="btn-nav btn-next" onclick="nextStep(3)">Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯</button>
        <button class="btn-nav btn-back" onclick="nextStep(1)">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>

    <div id="step-3" class="step-card">
        <h4 class="mb-2">Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±ÙˆØ³ Ø§Ù…Ø±ÙˆØ²</h4>
        <p class="small text-muted mb-4">Ø¯Ø±ÙˆØ³ÛŒ Ú©Ù‡ Ø§Ù…Ø±ÙˆØ² Ù…Ø·Ø§Ù„Ø¹Ù‡ Ú©Ø±Ø¯ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†:</p>
        <div id="lesson-container">
            </div>
        <button class="btn-nav btn-next mt-4" onclick="nextStep(4)">ØªØ§ÛŒÛŒØ¯ Ø¯Ø±ÙˆØ³</button>
        <button class="btn-nav btn-back" onclick="nextStep(2)">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>

    <div id="step-4" class="step-card">
        <h4 class="mb-4">Ø¢Ù…Ø§Ø± Ø¯Ø±ÙˆØ³ ØªØ®ØµØµÛŒ</h4>
        <label>Ù…Ø¬Ù…ÙˆØ¹ Ø³Ø§Ø¹Øª Ù…Ø·Ø§Ù„Ø¹Ù‡ ØªØ®ØµØµÛŒ:</label>
        <input type="number" id="studySpec" class="form-control form-control-lg mb-4" step="0.5" placeholder="0">
        <label>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ ØªØ³Øª ØªØ®ØµØµÛŒ:</label>
        <input type="number" id="testSpec" class="form-control form-control-lg mb-4" placeholder="0">
        <label>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø§Ø±Ú©Ø¯Ø§Ø± ØªØ®ØµØµÛŒ:</label>
        <input type="number" id="markedSpec" class="form-control form-control-lg mb-4" placeholder="0">
        <button class="btn-nav btn-next" onclick="nextStep(5)">Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯</button>
        <button class="btn-nav btn-back" onclick="nextStep(3)">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>

    <div id="step-5" class="step-card">
        <h4 class="mb-4">Ø¢Ù…Ø§Ø± Ø¯Ø±ÙˆØ³ Ø¹Ù…ÙˆÙ…ÛŒ</h4>
        <label>Ù…Ø¬Ù…ÙˆØ¹ Ø³Ø§Ø¹Øª Ù…Ø·Ø§Ù„Ø¹Ù‡ Ø¹Ù…ÙˆÙ…ÛŒ:</label>
        <input type="number" id="studyGen" class="form-control form-control-lg mb-4" step="0.5" placeholder="0">
        <label>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ ØªØ³Øª Ø¹Ù…ÙˆÙ…ÛŒ:</label>
        <input type="number" id="testGen" class="form-control form-control-lg mb-4" placeholder="0">
        <button class="btn-nav btn-next" onclick="nextStep(6)">Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯</button>
        <button class="btn-nav btn-back" onclick="nextStep(4)">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>

    <div id="step-6" class="step-card text-center">
        <h4 class="mb-5">Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯</h4>
        <label class="mb-3">Ø±Ø¶Ø§ÛŒØª Ø§Ø² Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø®ÙˆØ¯Øª (Û± ØªØ§ Ûµ):</label>
        <input type="range" class="form-range mb-5" min="1" max="5" id="satSelf" oninput="v1.innerText=this.value">
        <div class="display-4 text-primary fw-bold" id="v1">3</div>
        
        <label class="mt-5 mb-3">Ø±Ø¶Ø§ÛŒØª Ø§Ø² Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø´Ø§ÙˆØ± (Û± ØªØ§ Ûµ):</label>
        <input type="range" class="form-range mb-4" min="1" max="5" id="satConsult" oninput="v2.innerText=this.value">
        <div class="display-4 text-success fw-bold" id="v2">3</div>

        <button class="btn-nav btn-next mt-5 py-3 fs-5" style="background: #28a745;" onclick="finalSubmit()">ğŸš€ Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ Ú¯Ø²Ø§Ø±Ø´ Ø¯Ø± Ø³ÛŒØ³ØªÙ…</button>
    </div>

</div>

<script>
    // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ù„Ø§Ú¯ÛŒÙ† Ø´Ø¯Ù‡
    const profile = JSON.parse(localStorage.getItem("profile") || "{}");
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyyJaeaBi301y227SSIEzoWO9G9MqJXSKfesvVca2vh7vsf207NRmLxxXCOkn-PaACf/exec";

    function nextStep(s) {
        document.querySelectorAll('.step-card').forEach(c => c.classList.remove('active'));
        document.getElementById('step-' + s).classList.add('active');
        document.getElementById('main-progress').style.width = ((s-1) / 5 * 100) + '%';
        if(s === 3) buildLessons();
    }

    function toggleHabit(el, type) {
        el.classList.toggle('selected');
        const chk = el.querySelector('input');
        chk.checked = !chk.checked;
        if(type === 'mobile') document.getElementById('mobile-box').classList.toggle('d-none');
    }

    function buildLessons() {
        const container = document.getElementById('lesson-container');
        container.innerHTML = "";
        // Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±Ø´ØªÙ‡ Ùˆ Ù¾Ø§ÛŒÙ‡ Ø¯Ø±ÙˆØ³ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒ Ø¯Ù‡ÛŒÙ…
        const lessons = (profile.studyField === "ØªØ¬Ø±Ø¨ÛŒ") ? ["Ø²ÛŒØ³Øª", "Ø²Ù…ÛŒÙ†", "Ø´ÛŒÙ…ÛŒ", "ÙÛŒØ²ÛŒÚ©", "Ø±ÛŒØ§Ø¶ÛŒ"] : ["Ø±ÛŒØ§Ø¶ÛŒ", "ÙÛŒØ²ÛŒÚ©", "Ø´ÛŒÙ…ÛŒ", "Ù‡Ù†Ø¯Ø³Ù‡", "Ø¢Ù…Ø§Ø±"];
        lessons.forEach(l => {
            const span = document.createElement('span');
            span.className = 'lesson-chip';
            span.innerText = l;
            span.onclick = function() { this.classList.toggle('active'); };
            container.appendChild(span);
        });
    }

    async function finalSubmit() {
        document.getElementById('main-progress').style.width = '100%';
        
        const data = {
            action: "saveReport",
            username: profile.username || "guest",
            week: document.getElementById('weekNum').value,
            studySpec: document.getElementById('studySpec').value,
            testSpec: document.getElementById('testSpec').value,
            marked: document.getElementById('markedSpec').value,
            studyGen: document.getElementById('studyGen').value,
            testGen: document.getElementById('testGen').value,
            satSelf: document.getElementById('satSelf').value,
            satConsult: document.getElementById('satConsult').value,
            mobileTime: document.getElementById('mobileTime').value || 0
        };

        try {
            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(data) });
            alert("ØªØ¨Ø±ÛŒÚ© " + profile.firstName + " Ø¹Ø²ÛŒØ²! Ú¯Ø²Ø§Ø±Ø´ Ø§Ù…Ø±ÙˆØ²Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.");
            location.href = "index.html";
        } catch (e) {
            alert("Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª! Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.");
        }
    }
</script>
</body>
</html>